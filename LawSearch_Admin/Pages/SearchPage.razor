@page "/";
@using LawSearch_Admin.ViewModels
@inject ISearchAdminService searchAdminService;
@inject IArticalAdminService articalAdminService;

<div class="ss">
    <div class="search-container">
        <div class="search-input">
            <input class="input" type="text" placeholder="Bạn cần tìm kiếm gì?" spellcheck="false" @bind-value="@input" />
        </div>
        <div class="search-button" @onclick="SearchAction">
            <img class="search-icon" src="assests/icon/search_icon.png" />
        </div>
    </div>

    @if (lstResult != null)
    {
        <div class="result-container">
            <div class="result-total">
                Khoảng @lstResult.Count kết quả - Thời gian tìm kiếm @Math.Round(timeDone, 6) giây
            </div>
                @for (int i = 0; i < lstResult.Count; i++)
                {
                    <SearchResultItem Rank="@(i+1)" Artical="@lstResult[i]" />
                }
        </div>
    } 
</div>

@code{
    public string rank = "Rank #1";
    public string title = "Điều 83 | Chương 6 | Luật đất đai 2013";

    public string input ;
    public List<ArticalResult> lstResult = null;
    public List<Artical> lstArtical;

    public double timeDone = 0;

    protected override async Task OnInitializedAsync()
    {
        var data = await articalAdminService.GetListArtical();
        lstArtical = data;
    }

    private async void SearchAction(){
        if(input.Length >= 12)
        {
            var stopwatch = new System.Diagnostics.Stopwatch();
            stopwatch.Start();

            var rs = await searchAdminService.GetResultSearchLaw(input);

            stopwatch.Stop();
            timeDone = stopwatch.Elapsed.TotalMilliseconds / 1000F;

            lstResult = rs;
            StateHasChanged();  //Re-render dom
        }
    }
}