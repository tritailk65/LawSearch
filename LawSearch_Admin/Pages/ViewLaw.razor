@page "/viewlaw"
@inject ILawDocAdminService lawDocAdminService;

<div class="body-container">
    <div class="header-content">
        <div class="title">
            Select your document
        </div>
        <select class="custom-select" @onchange="GetDataLaw">
            @if (lstLawDoc != null)
            {
                @foreach (var law in lstLawDoc)
                {
                    <option class="dropdown-item" value="@law.ID">@law.Name</option>
                }
            }
        </select>
        <div class="btn">
            <Button ButtonStyle="reset-button btn-custom" @onclick="() => {}">
                View full document
            </Button>
        </div>
    </div>

    <div class="main-content">
        @if(lawVM == null)
        {
            <div class="loading_">
                <span class="loader"></span>
            </div>
        } else if(lawVM != null)
        {
            <div class="left-content">
                <div class="index">
                    @if (lawVM.lstChapters.Count > 0)
                    {
                        foreach (var c in lawVM.lstChapters)
                        {
                            <div class="chapter">
                                <img class="icon" src="assets/icon/item_down.png" aria-hidden="true" />
                                @c.Name @c.Title [@c.ID]
                            </div>
                            if (c.lstSections != null && c.lstSections.Count > 0)
                            {
                                foreach (var s in c.lstSections)
                                {
                                    if(s.Name != "")
                                    {
                                        <div class="section">
                                            <img class="icon" src="assets/icon/item_down.png" aria-hidden="true" />
                                            @s.Name [@s.ID]
                                        </div>
                                    }
                                    if (s.lstArticals.Count > 0)
                                    {
                                        foreach (var a in s.lstArticals)
                                        {
                                            <div class="artical">
                                                <img class="icon" src="assets/icon/item_up.png" aria-hidden="true" />
                                                @a.Name: @a.Title [@a.ID]
                                            </div>
                                        }
                                    }
                                }
                            }
                        }
                    }
                </div>
            </div>
        }
        <div class="right-content">
            @if(lawHTML != null)
            {
                @((MarkupString)lawHTML.contentHTML);
            }   
        </div>
    </div>
</div>

@code {
    public List<LawDoc> lstLawDoc = new List<LawDoc>();

    public LawVM lawVM = new LawVM();
    public LawHTML lawHTML = new LawHTML();

    protected override async Task OnInitializedAsync()
    {
        lawVM = null;
        lawHTML = null;
        var lstLawDocData = await lawDocAdminService.GetListLawDoc();
        lstLawDoc = lstLawDocData;
        var loadHTML = await lawDocAdminService.GetLawHTML(lstLawDoc[0].ID);
        lawHTML = loadHTML;
        var data = await lawDocAdminService.GetDataLaw(lstLawDoc[0].ID);
        lawVM = data;

    }

    private async void GetDataLaw(ChangeEventArgs e)
    {
        lawVM = null;
        lawHTML = null;
        int id = Convert.ToInt32(e.Value);
        var loadHTML = await lawDocAdminService.GetLawHTML(id);
        lawHTML = loadHTML;
        var data = await lawDocAdminService.GetDataLaw(id);
        lawVM = data;
        StateHasChanged();
    }
}
